(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(2518)}])},2518:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return P}});var l=a(5893),n=a(7294),i=a(6741),s=a(2639),r=a(182),o=a(9331),c=a(2116),d=a(5256),m=a(8051),x=a(8294),u=a.n(x);let h=async e=>new Promise((t,a)=>{let l=new FileReader;l.onload=l=>{try{let a=new(u());a.parse(l.target.result);let n=a.tracks[0].name,i=a.tracks[0].points,s=a.tracks[0].distance.total/1e3,r=i[0].time.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),o=(i[i.length-1].time-i[0].time)/1e3/60,c=function(e){let t=[],a=0;for(let l=1;l<e.length;l++){let n=e[l-1],i=e[l],s=g([n.lat,n.lon],[i.lat,i.lon]);a+=s,t.push({time:i.time,distance:a})}return t}(i),d=i.map((e,t)=>({time:e.time,elevation:e.ele,distance:c[t].distance})),m=p(function(e){let t=[];for(let a=1;a<e.length;a++){let l=e[a-1],n=e[a],i=new Date(l.time),s=new Date(n.time),r=(s-i)/1e3,o=n.ele-l.ele,c=3600*o/r;t.push({time:n.time,elevationSpeed:c})}return t}(i),"elevationSpeed",30).map((e,t)=>({...e,distance:c[t].distance})),x=p(function(e){let t=[];for(let a=1;a<e.length;a++){let l=e[a-1],n=e[a],i=new Date(l.time),s=new Date(n.time),r=(s-i)/1e3*3600,o=g([l.lat,l.lon],[n.lat,n.lon]),c=o*r;c<1e3&&t.push({time:n.time,speed:c})}return t}(i),"speed",30).map((e,t)=>({...e,distance:c[t].distance})),h=p(function(e){let t=[];for(let a=1;a<e.length;a++){let l=e[a-1],n=e[a],i=new Date(l.time),s=new Date(n.time),r=(s-i)/1e3/60,o=g([l.lat,l.lon],[n.lat,n.lon]);if(r>0&&o>.001){let e=r/o;if(e>300)continue;t.push({time:n.time,pace:e})}}return t}(i),"pace",30).map((e,t)=>({...e,distance:c[t].distance})),f=a.tracks[0].elevation.min,v=a.tracks[0].elevation.max,j=a.tracks[0].elevation.pos;t({date:r,title:n,distance:s,duration:o,distanceData:c,elevationData:d,elevationSpeedData:m,speedData:x,paceData:h,averageSpeed:s/(o/60),minElevation:f,maxElevation:v,posElevation:j,fileName:e.name})}catch(e){a(e)}},l.onerror=()=>{a(Error("Error reading the GPX file."))},l.readAsText(e)});function g(e,t){let[a,l]=e,[n,i]=t,s=(n-a)*Math.PI/180,r=(i-l)*Math.PI/180,o=Math.sin(s/2)*Math.sin(s/2)+Math.cos(a*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function p(e,t,a){let l=[];for(let n=0;n<e.length-a+1;n++){let i=e.slice(n,n+a),s=i.reduce((e,a)=>e+a[t],0)/a;l.push({time:i[a-1].time,[t]:parseFloat(s.toFixed(2))})}return l}let f=e=>{let{title:t,value:a,bgColor:n,textColor:i,Icon:s}=e;return(0,l.jsxs)("div",{className:"card ".concat(n," ").concat(i),children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(s,{className:"icon h-10 w-10 mr-2"}),(0,l.jsx)("div",{className:"title",children:t})]}),(0,l.jsx)("div",{className:"value",children:a})]})},v=e=>{let{onFileChange:t,fileName:a}=e,i=(0,n.useRef)(null),s=()=>{i.current.click()};return(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-md",onClick:s,children:a?"Upload another GPX file":"Upload a GPX file"}),(0,l.jsx)("input",{className:"hidden",ref:i,type:"file",onChange:t})]})};var j=a(9253),b=a(943),y=a(3023),w=a(5358),N=a(4888),k=a(6108);let C=e=>{let{data:t,className:a,dataKey:n,stroke:i,fill:s,yAxisLabel:r,Icon:o}=e;return(0,l.jsxs)("div",{className:"p-4 rounded-lg shadow-md bg-gray-100 text-gray-900",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)(o,{className:"icon h-6 w-6 mr-2"}),(0,l.jsx)("h3",{children:r})]}),(0,l.jsx)(j.h,{width:"100%",height:250,children:(0,l.jsxs)(b.T,{syncId:"anyId",className:"".concat(a),width:500,height:250,data:t,margin:{top:5,right:20,bottom:5,left:0},children:[(0,l.jsx)(y.K,{dataKey:"distance"}),(0,l.jsx)(w.B,{label:{value:r,angle:-90,position:"insideLeft"}}),(0,l.jsx)(N.u,{}),(0,l.jsx)(k.u,{type:"monotone",dataKey:n,stroke:i,fill:s})]})})]})};var D=a(1120),I=a.n(D);let M=e=>{let{targetRef:t}=e,a=(0,n.useRef)(null),i=async()=>{let e=await I()(t.current),l=e.toDataURL();a.current.href=l,a.current.download="activity-summary.png",a.current.click()};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"bg-green-500 text-white px-4 py-2 rounded-md",onClick:i,children:"Download summary"}),(0,l.jsx)("a",{className:"hidden",ref:a})]})},E=()=>(0,l.jsx)("p",{className:"text-lg",children:"Extension of https://github.com/acid3croco/activity-summary-app.git to feature better elevation analysis, make by Marin Hamrouni, Adrian Jarret and Gabriel Payen"}),F=()=>{let e=(0,n.useRef)(),[t,a]=(0,n.useState)(null),x=async e=>{let t=e.target.files[0],l=await h(t);console.log(l),a(l)};return(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsxs)("div",{className:"p-4 flex flex-col space-y-4",children:[null===t&&(0,l.jsx)(E,{}),(0,l.jsxs)("div",{className:"flex space-x-4 ",children:[(0,l.jsx)(v,{onFileChange:x,fileName:t&&t.fileName}),t&&(0,l.jsx)(M,{targetRef:e})]}),t&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{ref:e,className:"flex flex-col space-y-4",children:[(0,l.jsxs)("h2",{className:"text-4xl font-bold text-blue-800 bg-gradient-to-r from-blue-200 to-blue-500 inline-block p-2 rounded-lg",children:["Ride: ",t.title]}),(0,l.jsxs)("div",{className:"metrics-section grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[(0,l.jsx)(f,{title:"Date",value:t.date,bgColor:"bg-blue-100",textColor:"text-blue-900",Icon:i}),(0,l.jsx)(f,{title:"Distance",value:"".concat(t.distance.toFixed(2)," km"),bgColor:"bg-green-100",textColor:"text-green-900",Icon:s}),(0,l.jsx)(f,{title:"Duration",value:"".concat(t.duration.toFixed(2)," min"),bgColor:"bg-yellow-100",textColor:"text-yellow-900",Icon:r}),(0,l.jsx)(f,{title:"Average Speed",value:"".concat(t.averageSpeed.toFixed(2)," km/h"),bgColor:"bg-purple-100",textColor:"text-purple-900",Icon:o}),(0,l.jsx)(f,{title:"Positive Elevation",value:"+".concat(t.posElevation.toFixed(1),"m"),bgColor:"bg-orange-100",textColor:"text-orange-900",Icon:c}),(0,l.jsx)(f,{title:"Min & Max Elevation",value:"".concat(t.minElevation.toFixed(1),"m / ").concat(t.maxElevation.toFixed(1),"m"),bgColor:"bg-red-100",textColor:"text-red-900",Icon:c})]}),(0,l.jsxs)("div",{className:"charts-section grid grid-cols-1 gap-4",children:[(0,l.jsx)(C,{Icon:d,data:t.elevationData,dataKey:"elevation",stroke:"#8884d8",fill:"#8884d8",yAxisLabel:"Elevation (m)"}),(0,l.jsx)(C,{Icon:m,data:t.elevationSpeedData,dataKey:"elevationSpeed",stroke:"#82ca9d",fill:"#82ca9d",yAxisLabel:"Vertical speed (m/h)"}),(0,l.jsx)(C,{Icon:o,data:t.speedData,dataKey:"speed",stroke:"#dc6e00",fill:"#dc6e00",yAxisLabel:"Speed (km/h)"}),(0,l.jsx)(C,{Icon:m,data:t.paceData,dataKey:"pace",stroke:"#82ca9d",fill:"#82ca9d",yAxisLabel:"Pace (min/km)"})]})]})})]})})};var P=F}},function(e){e.O(0,[443,124,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);